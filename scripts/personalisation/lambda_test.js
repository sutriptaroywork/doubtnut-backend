let records = [{
    messageId: '30b39a56-b061-4422-aff4-51166549c470',
    receiptHandle:
        'AQEBEvQkBUmI6Y3g1GjaqFrVvPYzbLC16a9iNbPz2ejPhJ8EA8EGsdXNA2sZmbOrfEfoZgtAzBLbOovSiqSc7XX7t+/fzHwcqrToh//WYhqYdH0l9mBQFbAO5Z4Kc7sGMKEWnPRY26kiiepKBnXiTmzuXrqSPA8Zc6FTwjNqeMp4KrUwfeIS0CbBecuFZbgQWSzGOxV2iXELUlaC12y+NeZZWgboX3idk6kXSlmUMqc0AmPfjPn8ta+v4w6cQhTfyIt7d4SB1Yqnfd+fEFZNUYtNXZsMvDarPptACOnuZ8Y9+zJmqPlgGJQFo/Xx9jPpDqxyYYpmN/oIKMDg/GvZXxIadny/tHLbWGW/nef2w8O6QuQ6ibtYwi2cBYfXMyR3yLvvL8e02PCDhraxSXeEA0ZBLQ==',
    body:
        '{\n  "Type" : "Notification",\n  "MessageId" : "80b61caa-4be9-59e8-b0be-4afada6bbbbd",\n  "TopicArn" : "arn:aws:sns:ap-south-1:942682721582:video_views",\n  "Message" : "{\\"action\\":\\"VIDEO_VIEW_FROM_APP\\",\\"data\\":{\\"student_id\\":7722434,\\"question_id\\":2462296,\\"answer_id\\":133218,\\"answer_video\\":\\"answer-1535700877.mp4\\",\\"video_time\\":0,\\"engage_time\\":0,\\"parent_id\\":\\"0\\",\\"is_back\\":0,\\"session_id\\":\\"0\\",\\"tab_id\\":\\"0\\",\\"ip_address\\":0,\\"source\\":\\"android\\",\\"view_from\\":\\"SEARCH_SRP\\",\\"referred_st_id\\":0,\\"view_id\\":110339578},\\"uuid\\":\\"250d2d97-a5b2-410e-b712-1025cdae911c\\",\\"timestamp\\":\\"2019-11-21T18:50:53.842Z\\"}",\n  "Timestamp" : "2019-11-21T13:21:06.492Z",\n  "SignatureVersion" : "1",\n  "Signature" : "YzhVlG+JO5arIPL0vIUM+2HjUtEdmpz6VL+fqmITlOTnzhvXUKyD3adJ9Js/Pnd2T8QKebI+ZvN9n8tGOYc4GZeFQNwmhbo1yDrKnP781hM8e/fXZj5HSjGqD8CJuUNYYLfDwjt3a0xq3KmLjEo1iMeMaySFevpOo6qDmkQyLPnFlTdOZXihtt7ecn0h44npzHKcWWoPCkfsssODd/KI4htCmJK5KL0xkwYCkNbR9zwW7TvwWzi2ShVsaso3gr0BR8h/x5iuCCaX6gXzV72GMnmC7vQ2tjXB/y/3U8k47RTpWur+osNj1uinYC6LizG4VPouD4ftIstoDbGE2uAWIQ==",\n  "SigningCertURL" : "https://sns.ap-south-1.amazonaws.com/SimpleNotificationService-6aad65c2f9911b05cd53efda11f913f9.pem",\n  "UnsubscribeURL" : "https://sns.ap-south-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:ap-south-1:942682721582:video_views:c8c78ae9-fef1-409e-b80c-93c65c683d9c"\n}',
    attributes:
        {
            ApproximateReceiveCount: '1',
            SentTimestamp: '1574342466526',
            SenderId: 'AIDAJKTPXYYAO6CI6DPKS',
            ApproximateFirstReceiveTimestamp: '1574343767896'
        },
    messageAttributes: {},
    md5OfBody: 'c3256c448e624061ec49bb9ed1facc51',
    eventSource: 'aws:sqs',
    eventSourceARN: 'arn:aws:sqs:ap-south-1:942682721582:user-personalisation',
    awsRegion: 'ap-south-1'
},
    {
        messageId: '3ef841bc-c20e-48bc-8f14-7b4dd4a3daa7',
        receiptHandle:
            'AQEBGkxfYQN2S+44yhk72I0cyEQLR3KdRtv3oZrJFmT12Er/tG8AMbtEjtLdwYrZ1efNh1gzquI6JVpe9kfZUXvCGkwdfcFZGSIHL5GeFaQTXtaRl3L8TxEuCBhkFBFuOE5fEMcVreKyq2vTM09uZDQyfvMW5Ov4Ui6sLjuPaMFlYQYVZnDcyGwW9V6pfT9etkHWI0/Y+XZrWpy/VqFAV+GdpiLMa+lIPBSk7BJCNVzw4RW/4w/TZrGCebefUNi7e7R9YpLXmbgmy5eOTXKcaOdtVkVSb9rT98UxRPXrfkYiEwYBhE+AwKIPg0liIteoL/OIZNxYP5C7BSRazJMcxEwf4J7HkFwDqREHfWlJkHrrBfsaEkJbOus5NUdPCoXAbiEuRUQuXKx5L7uBUk8Dspwu0Q==',
        body:
            '{\n  "Type" : "Notification",\n  "MessageId" : "e0ccf9cf-f104-5f8f-b773-af9f608ebcc2",\n  "TopicArn" : "arn:aws:sns:ap-south-1:942682721582:video_views",\n  "Message" : "{\\"action\\":\\"VIDEO_VIEW_FROM_APP\\",\\"data\\":{\\"student_id\\":7150096,\\"question_id\\":1748,\\"answer_id\\":1748,\\"answer_video\\":\\"XII_05_E03_10.mp4\\",\\"video_time\\":0,\\"engage_time\\":0,\\"parent_id\\":\\"0\\",\\"is_back\\":0,\\"session_id\\":\\"0\\",\\"tab_id\\":\\"0\\",\\"ip_address\\":0,\\"source\\":\\"android\\",\\"view_from\\":\\"SIMILAR\\",\\"referred_st_id\\":0,\\"view_id\\":110339740},\\"uuid\\":\\"e462c552-6b17-4a96-ab2f-3f58375ad058\\",\\"timestamp\\":\\"2019-11-21T18:51:14.555Z\\"}",\n  "Timestamp" : "2019-11-21T13:21:14.998Z",\n  "SignatureVersion" : "1",\n  "Signature" : "nMiQx9ya+ILhwx6UrJicaFUlpcRXTUtlIrRY5fMJiiN6gBRwSTSAL9n9KiiF7DYFv8Dvv7lIZv4skWdN7TJ0QDtMFO4IHBiQpmIa80CAU5Y/OcSsyXwgWR7bZYsxlhsvtsUsAXS0DxoPRfvPPaQqrQA09nWoXNfqbOtxZTByEx4W5Jx0vNXtDtPR3q5RngrnuQOGUiYYPMLNZGQuwXvYuCfVz/UeG4LRXopyjqZMMTEZvC8oi29DcE9aIDbc8HT8yY1b0gitZlHEXU2V3NkLv8cdcq8C310TrhbGyThjBnbAQQDpxtn8alNNYwpwfyqGiuMSEEMEivKIEhfbw2miFA==",\n  "SigningCertURL" : "https://sns.ap-south-1.amazonaws.com/SimpleNotificationService-6aad65c2f9911b05cd53efda11f913f9.pem",\n  "UnsubscribeURL" : "https://sns.ap-south-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:ap-south-1:942682721582:video_views:c8c78ae9-fef1-409e-b80c-93c65c683d9c"\n}',
        attributes:
            {
                ApproximateReceiveCount: '1',
                SentTimestamp: '1574342475022',
                SenderId: 'AIDAJKTPXYYAO6CI6DPKS',
                ApproximateFirstReceiveTimestamp: '1574343767897'
            },
        messageAttributes: {},
        md5OfBody: '547e0ca341f3b8ffa9044acb148ed019',
        eventSource: 'aws:sqs',
        eventSourceARN: 'arn:aws:sqs:ap-south-1:942682721582:user-personalisation',
        awsRegion: 'ap-south-1'
    },
    {
        messageId: '61172294-d705-4ccd-b0d1-1be0137ba707',
        receiptHandle:
            'AQEB+920UZGs2kyBQwGFe2RgJCeXADZpJHqK9/RbNXPwfKa/cthk53aLA6OIkbuKgFnGBn0d+6zuNMhxW3P/blJcFLOK/ZZeNjv3nGA/+oFdemJAKqoU0c6oX/6I5gc2hkm7KSEtzz5sW2/wLLb7fvLWTG0qyf+TDwUAo076XIHdQ9iott+cJ6587/hYDD76+w6il3k1haxCnew7shMtUKdvCNfV7qb+yCdQ1NXpov4i9paFxKwGFuWNcWDM421F9SmDn5d42v+54NIzyL/ZR4k3u1xn8KAsMhVIUw5iKPOePhKXuDBMJvCtHwqQE4nkz7bJbLf7Sox3qcFofAcr3HoLs1EB2ix/ILeh7fvCs4hoairo89QUpNtRDS/dEHL2DtEl4jbf/ixxaNsxtZCW/sDNMg==',
        body:
            '{\n  "Type" : "Notification",\n  "MessageId" : "7d51d190-9cab-586d-83d6-87c00d207bc6",\n  "TopicArn" : "arn:aws:sns:ap-south-1:942682721582:video_views",\n  "Message" : "{\\"action\\":\\"VIDEO_VIEW_FROM_APP\\",\\"data\\":{\\"student_id\\":1797624,\\"question_id\\":11745908,\\"answer_id\\":275550,\\"answer_video\\":\\"answer-1558933607_11745908.mp4\\",\\"video_time\\":0,\\"engage_time\\":0,\\"parent_id\\":\\"0\\",\\"is_back\\":0,\\"session_id\\":\\"0\\",\\"tab_id\\":\\"0\\",\\"ip_address\\":0,\\"source\\":\\"android\\",\\"view_from\\":\\"NOTIFICATION\\",\\"referred_st_id\\":0,\\"view_id\\":110339746},\\"uuid\\":\\"1824b9f8-f6c1-4b11-9220-6fa8fde3709a\\",\\"timestamp\\":\\"2019-11-21T18:51:14.926Z\\"}",\n  "Timestamp" : "2019-11-21T13:21:15.370Z",\n  "SignatureVersion" : "1",\n  "Signature" : "KePAkgaEF7TOXlk7OVe/j5CrP7HZc55IpZDKPGkOa3HgxRiIgSZgwwz+0ZgsI7cxobD5+F27rID7EOLar13RHdI4aKJSa6PqemB/hZhoorarn9T7rVgc0Q0fWf9XtfPNxKXTRb1+s5ffcH/Da0FT5uM8Jg7t6/kZhwm2N4czvssvgtLr+Wyf38pRScu1ybA5BjqdvulTUoFe7k1Z+k3v8qzr4Se4QdnK0SElqRWyanpLDoONh3M8DUuSTQ8s8KK4eeGtsL7FJ/7tPVscStxmxUWtJyYxQmvLjOn782UW4ciOSmjeGjouftciIGe904SGxtKGJPOphEIUSqDr7Ce0xQ==",\n  "SigningCertURL" : "https://sns.ap-south-1.amazonaws.com/SimpleNotificationService-6aad65c2f9911b05cd53efda11f913f9.pem",\n  "UnsubscribeURL" : "https://sns.ap-south-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:ap-south-1:942682721582:video_views:c8c78ae9-fef1-409e-b80c-93c65c683d9c"\n}',
        attributes:
            {
                ApproximateReceiveCount: '1',
                SentTimestamp: '1574342475392',
                SenderId: 'AIDAJKTPXYYAO6CI6DPKS',
                ApproximateFirstReceiveTimestamp: '1574343767897'
            },
        messageAttributes: {},
        md5OfBody: '6f34f549b94a3ed51300dc4fad5ecde7',
        eventSource: 'aws:sqs',
        eventSourceARN: 'arn:aws:sqs:ap-south-1:942682721582:user-personalisation',
        awsRegion: 'ap-south-1'
    },
    {
        messageId: '86b347c2-80e5-4477-a299-be725f405b78',
        receiptHandle:
            'AQEBIUfsl/9V2IDXTztGJ2MxI5hbOCVm2jHWxI11DiB2hcNtWMjjPbIPqTUzRCczvG+/2D+zx3mVVcxOfTYPb/gqO66cRh+sGs5qUo3iZXmgoiixRoMHYDsdufr8WgSfSYdDR1POvkv/iacrnr9IM1+KdjWpVnJhDpn3hTPRfP1CAduqncT8cgjWhy1APWpegH2+Ro4pCy2XXwbdjFi+eQdlJJ+kTtMcTRpQ0JsNtel8tsZ1a+bcUtuqpapcKcMRQuOFElcw0YiiIuyFde730sSXf5wdN+Sqgf3Nby29Q3qSAkSlTZT/aPzmFqHOTQ/qRW/xa12b+/X1BvWYEt10PiD4i6GInDZSojOhyv8N7N3H8P/IuHFIYL4HWjj/aJ6H5NIx1CfqHLf/r4t8YyzKQfMqMA==',
        body:
            '{\n  "Type" : "Notification",\n  "MessageId" : "84022b22-6c89-50ff-a1e5-7d72fd02c60e",\n  "TopicArn" : "arn:aws:sns:ap-south-1:942682721582:video_views",\n  "Message" : "{\\"action\\":\\"VIDEO_VIEW_FROM_APP\\",\\"data\\":{\\"student_id\\":8089468,\\"question_id\\":13077468,\\"answer_id\\":351869,\\"answer_video\\":\\"answer-1560511193_13077468.mp4\\",\\"video_time\\":0,\\"engage_time\\":0,\\"parent_id\\":\\"0\\",\\"is_back\\":0,\\"session_id\\":\\"0\\",\\"tab_id\\":\\"0\\",\\"ip_address\\":0,\\"source\\":\\"android\\",\\"view_from\\":\\"SIMILAR\\",\\"referred_st_id\\":0,\\"view_id\\":110339753},\\"uuid\\":\\"efe3ca8d-fce6-476c-9027-7bf9e6887622\\",\\"timestamp\\":\\"2019-11-21T18:51:03.113Z\\"}",\n  "Timestamp" : "2019-11-21T13:21:15.764Z",\n  "SignatureVersion" : "1",\n  "Signature" : "HDNMCZ9PDPMVM0OPkceug/1afBY+cT7qR5oYUAAeHq9uK0eITIjfrdhK98vZK9CuKIHRyMSxE1PNtXSSsBsmnsU1J8GKms0NSa+8S+s1m7bQGMYtkAUwvpxYYGX2H3+odBP75KjXlzcvp718E0hLb9TchPK3jNFsIzX0lP8FNpoqClaKmyhEcQgO1rc3MBqJr4DaBbUKEZFmWIGICvcyYNVgG2QZrQhlq4Fyx3OhdNzqZH/VXY3QT3OXO3aoJFlRIimLAXChwVGIp7QvWZeVpF/c/Z//P8kEp5nqr+SlfQcd6rFLsaPdqL9un1RB67nsCFQxdF40gTqceei+oLI/eg==",\n  "SigningCertURL" : "https://sns.ap-south-1.amazonaws.com/SimpleNotificationService-6aad65c2f9911b05cd53efda11f913f9.pem",\n  "UnsubscribeURL" : "https://sns.ap-south-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:ap-south-1:942682721582:video_views:c8c78ae9-fef1-409e-b80c-93c65c683d9c"\n}',
        attributes:
            {
                ApproximateReceiveCount: '1',
                SentTimestamp: '1574342475786',
                SenderId: 'AIDAJKTPXYYAO6CI6DPKS',
                ApproximateFirstReceiveTimestamp: '1574343767897'
            },
        messageAttributes: {},
        md5OfBody: '2daf7983bf456748cc6fea3388298250',
        eventSource: 'aws:sqs',
        eventSourceARN: 'arn:aws:sqs:ap-south-1:942682721582:user-personalisation',
        awsRegion: 'ap-south-1'
    },
    {
        messageId: 'c8d31889-3ec3-47aa-9ccd-7f20b9409e70',
        receiptHandle:
            'AQEBSUSZ69fZuRcz/TD3Y9ubdCO2DXRqN8WKNDT878Iumzl4+r/ywxOFV9aDFaybLgej1GixIjS8sEd3YKUaqzoLeSAet9VDQOmgZnHw1zl35ISQyvPTqe8KBgssN0NWSw6iLT58VBdLSWObt0WgpYwS4BF1QzDbrCVRssaYKazi4DfYhsxmPrs0CEltK6w8JEL2KIDm975npfvomMPOMtsFycX3jraLhCAIAuiIf5EPVboQDvpCUD3dZn4rxRhDHdycpoh/o+/qgePm/sJWqaRxWHTQKyBI9DeFYNGeijul5thi/WbY+R0FO+BjhIUz/86Fjl3dUPueRHAAQ3rXgHXfpZdOdoA47cWwzQ5k1cciEeQn1ZedHS+8xkMI6439M8kajuU1RIemj2wFMfVVU+G8hw==',
        body:
            '{\n  "Type" : "Notification",\n  "MessageId" : "0e7dd749-37fe-546c-8404-8119a675bb01",\n  "TopicArn" : "arn:aws:sns:ap-south-1:942682721582:video_views",\n  "Message" : "{\\"action\\":\\"VIDEO_VIEW_FROM_APP\\",\\"data\\":{\\"student_id\\":3962267,\\"question_id\\":13078087,\\"answer_id\\":345550,\\"answer_video\\":\\"answer-1560418286_13078087.mp4\\",\\"video_time\\":0,\\"engage_time\\":0,\\"parent_id\\":\\"0\\",\\"is_back\\":0,\\"session_id\\":\\"0\\",\\"tab_id\\":\\"0\\",\\"ip_address\\":0,\\"source\\":\\"android\\",\\"view_from\\":\\"SIMILAR\\",\\"referred_st_id\\":0,\\"view_id\\":110339754},\\"uuid\\":\\"8c51c64c-97a8-450e-885e-1a9cde205352\\",\\"timestamp\\":\\"2019-11-21T18:51:15.332Z\\"}",\n  "Timestamp" : "2019-11-21T13:21:15.772Z",\n  "SignatureVersion" : "1",\n  "Signature" : "IC6qlEc4aIhEPmyVavL3ERX1fRsw24G32VKxVVMLvJOWAb+W8gKH84yj0ccu6dEjLFUoL0jbEq4vYI7mr3TiIxB/DD2AdsuNn4dR2X7OH9g1aK+dJvY9vwagf3pkuM3xAtIxGRZkwVtRCZGMUHtgFqhdspDFWs+kuTDv0LsGhkUEONI3Gqv+b3eWDfOhWzraz/UfTE9znpjsumOrEKuiaMU1IWHsTTpcyU0fD3GTQTc2UN2DkIrY5JDwELNAD32UuTnkNREoKvl5cV8OIl6kSGL+leFr+Z6ZG/sdZDcbMlhcflYn/8qqOj3hviZOujo9uo8Z+x+H/GWx0r1mndfwoA==",\n  "SigningCertURL" : "https://sns.ap-south-1.amazonaws.com/SimpleNotificationService-6aad65c2f9911b05cd53efda11f913f9.pem",\n  "UnsubscribeURL" : "https://sns.ap-south-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:ap-south-1:942682721582:video_views:c8c78ae9-fef1-409e-b80c-93c65c683d9c"\n}',
        attributes:
            {
                ApproximateReceiveCount: '1',
                SentTimestamp: '1574342475798',
                SenderId: 'AIDAJKTPXYYAO6CI6DPKS',
                ApproximateFirstReceiveTimestamp: '1574343767897'
            },
        messageAttributes: {},
        md5OfBody: '79eca0029ff7fcb3602fb9c45f15d263',
        eventSource: 'aws:sqs',
        eventSourceARN: 'arn:aws:sqs:ap-south-1:942682721582:user-personalisation',
        awsRegion: 'ap-south-1'
    },
    {
        messageId: '89e16fe2-1ca1-4a4c-8712-814435ffc9da',
        receiptHandle:
            'AQEBdegEoGvOuM2WUClmdjYL7dAShFbrRk6yVFVlXXa+S7pzD2xjZWwnn0C3tUrra8mK8MADv+d/31YO/FOhFgnGENx+f3xgHgbV832u7yiRZ439ezCn5owLxfN6F/JjxpBmG5ybTg+S1wklhJ9ylozezbqzzVTsCVrDDnMScn/tH2fBysg4mZ8F7Y/CsKQn9UmMXFEwzOuCX1LF3i/BSb58na0UWzgWft3MGmcLalxQyCCCMJ5HIMwAjosXfCqkF9MIPw8n6quv7ul3etWUiHQ+5fYcvZnq33pt7HmjaybxjYPOpSWwgtoMAR+7xSkSghFgHt5z93fyCKFzbPJzPfH3OSYOnXYrtBqisPFgDj1DMf5H6An5UwfzAM0loNbTuxVdpPsE2NpfSmNVsRkCMS20dw==',
        body:
            '{\n  "Type" : "Notification",\n  "MessageId" : "34b74088-9f94-59b7-99fa-16d80e1fc547",\n  "TopicArn" : "arn:aws:sns:ap-south-1:942682721582:video_views",\n  "Message" : "{\\"action\\":\\"VIDEO_VIEW_FROM_APP\\",\\"data\\":{\\"student_id\\":7849082,\\"question_id\\":5179,\\"answer_id\\":5021,\\"answer_video\\":\\"VIII_11_E01_04.mp4\\",\\"video_time\\":0,\\"engage_time\\":0,\\"parent_id\\":\\"0\\",\\"is_back\\":0,\\"session_id\\":\\"0\\",\\"tab_id\\":\\"0\\",\\"ip_address\\":0,\\"source\\":\\"android\\",\\"view_from\\":\\"SIMILAR\\",\\"referred_st_id\\":0,\\"view_id\\":110339755},\\"uuid\\":\\"1dbe2245-0e9c-4c26-bc98-ac95fec8139a\\",\\"timestamp\\":\\"2019-11-21T18:51:03.169Z\\"}",\n  "Timestamp" : "2019-11-21T13:21:15.819Z",\n  "SignatureVersion" : "1",\n  "Signature" : "UYPbylTAMw7uIIWu4GnVOVNyXyNnbRurAZwVK2K+asvpSHazT1cq3VzoqZxLDpuCHhzsB2HwQQ9haaziyq4RgAHdSBLZdPZ5uQB9IPeIgyuvdTHnSLp9eY9+NyrKPilnGlIZ23HgeOUHJhqDAW4zzeN+6ILelDxrsfDjBGz44QxAQc51Mb3isYU0xMNv1YpQ2hpbW/xrNeHWOsnY8Vqv1cMquUb5V5W6gjs8WrSfZm+mBds8gxH5fe9kET5XjdX4YVQj6k6/Jws3KomdEW8G68IvrN6tLtPbv7ey1HzBDLVQ7T1SF1b6NoAGg7O0PkJjHyVRIFBh52hzdjF3H3Z7CA==",\n  "SigningCertURL" : "https://sns.ap-south-1.amazonaws.com/SimpleNotificationService-6aad65c2f9911b05cd53efda11f913f9.pem",\n  "UnsubscribeURL" : "https://sns.ap-south-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:ap-south-1:942682721582:video_views:c8c78ae9-fef1-409e-b80c-93c65c683d9c"\n}',
        attributes:
            {
                ApproximateReceiveCount: '1',
                SentTimestamp: '1574342475852',
                SenderId: 'AIDAJKTPXYYAO6CI6DPKS',
                ApproximateFirstReceiveTimestamp: '1574343767897'
            },
        messageAttributes: {},
        md5OfBody: '3460106d4498a5ad6114c3a83d79c61d',
        eventSource: 'aws:sqs',
        eventSourceARN: 'arn:aws:sqs:ap-south-1:942682721582:user-personalisation',
        awsRegion: 'ap-south-1'
    },
    {
        messageId: '5b2f697a-9077-4303-88c8-a19098b4f662',
        receiptHandle:
            'AQEBnkgN4qPDrXvm9hg5OiYDyj8+Vu1Wevyfm8qXcprlwnGapMdM3dtK79kA/9MYQCLV+3uVVa0g1XhPvjWEC/akcW13BXteQFPOHFkVA/GjQmNKdDWmCukzBcnRa2hycOieNrpRXoS8QOa3Ilqiku8z5f1Epiklah+tziuQ6dEU3RJm6aWombgLIF6X9ihmB9k5R0wEBuY6t2vqxkZIravRsCt8BZMEyVKBvH/MR2DJdSlcjMzO3T1HHGYh+aNW4uf/apPaZq66WtxOR2zTwgno97ciOqm65+Dfa67n7SRZICoQGWF1OSiQOTGcyEJiz3DhOOF1SMZIMtklFBXe3rdGToH/gnogzPP1bIfD7utpDGRVwa4pc1UQDk0rXPDUBvuoi8H5hq6BOFtJEY6BrNWQaA==',
        body:
            '{\n  "Type" : "Notification",\n  "MessageId" : "0b945286-af65-5ff4-9907-04d63eeadb26",\n  "TopicArn" : "arn:aws:sns:ap-south-1:942682721582:video_views",\n  "Message" : "{\\"action\\":\\"VIDEO_VIEW_FROM_APP\\",\\"data\\":{\\"student_id\\":698211,\\"question_id\\":53793338,\\"answer_id\\":560392,\\"answer_video\\":\\"text\\",\\"video_time\\":0,\\"engage_time\\":0,\\"parent_id\\":\\"59608418\\",\\"is_back\\":0,\\"session_id\\":\\"0\\",\\"tab_id\\":\\"0\\",\\"ip_address\\":0,\\"source\\":\\"android\\",\\"view_from\\":\\"SRP\\",\\"referred_st_id\\":0,\\"view_id\\":110339848},\\"uuid\\":\\"d57ec23b-04c8-4a6f-a192-1ab3d77a0801\\",\\"timestamp\\":\\"2019-11-21T18:51:19.327Z\\"}",\n  "Timestamp" : "2019-11-21T13:21:19.769Z",\n  "SignatureVersion" : "1",\n  "Signature" : "Ilax988jpYYHnCkd2xLk8saVArgoD0zapEKr2dqQSZfgj0yVxu+MO8wzxiyQWAF8tNQ/GSFsmSV/7w4bmZOVOzAnVJ8rUViC5nrvAreG9PVmTl9vpcg8Y1jJ0oBYow+ai3nlnxqI+X39bKP2FeOIvk7FyiG2tfrS6zEMUIiyjWOq0FOLiBhSOGzg7hpJnTGnM390EOwfAnnBySxxM/ovzo/RzxczdYs/7qsmdeSsnMmlcsU3GpkF4Ynwmj/8HsSUkQqxYr8rPcdLI9b+9J3461lNJoCWF4iaLD77AsLik1meZ4gG/rwxy/HpS+nbyoUwWeTHVd7VhsQPxqJ8Hs1REg==",\n  "SigningCertURL" : "https://sns.ap-south-1.amazonaws.com/SimpleNotificationService-6aad65c2f9911b05cd53efda11f913f9.pem",\n  "UnsubscribeURL" : "https://sns.ap-south-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:ap-south-1:942682721582:video_views:c8c78ae9-fef1-409e-b80c-93c65c683d9c"\n}',
        attributes:
            {
                ApproximateReceiveCount: '1',
                SentTimestamp: '1574342479860',
                SenderId: 'AIDAJKTPXYYAO6CI6DPKS',
                ApproximateFirstReceiveTimestamp: '1574343767897'
            },
        messageAttributes: {},
        md5OfBody: 'e07a814cea8214df6e1ac1b327277d0d',
        eventSource: 'aws:sqs',
        eventSourceARN: 'arn:aws:sqs:ap-south-1:942682721582:user-personalisation',
        awsRegion: 'ap-south-1'
    },
    {
        messageId: 'd3bb8ba0-0d2c-40c2-bc78-618bac7ec8a7',
        receiptHandle:
            'AQEB8cA0GPp6tS03dpEAphWge1cJkBBTloeLuPl/R8EkNneLPqidMxr3L/MTAG92mtn4BwOM8UxKl9X56+evEsDsYuqfVYFg1xuRzFWpKgBJPqkk5U9M4QR2ORq96xdraVfMC0VpPXF9VeVyyBJ5+9oyMbNfVUu8DCOMR2H4uOeW21sLcNwPvIt60oXJi/h1IbIw8SmEN5/wicS1/CRHRXZoHgTEfCP+CHQtOiuLiw8AGh6+IcMeQ/iRIxT6j+reDTv2H3y75GNDQKtAzlExvJNh3nJRS/9CetjgXXRnpyichIk05GLl4pVP86IqxWtto4Qu03pyILoD8KD8EeJsGlwjrnP26Tdn600NvF233SK62pcmYxKUZF8NjmWwSsYYFh6+58OR54KmAdkCzfNJZXe0UA==',
        body:
            '{\n  "Type" : "Notification",\n  "MessageId" : "bb256369-adb5-5081-87dd-35393c3a9232",\n  "TopicArn" : "arn:aws:sns:ap-south-1:942682721582:video_views",\n  "Message" : "{\\"action\\":\\"VIDEO_VIEW_FROM_APP\\",\\"data\\":{\\"student_id\\":690315,\\"question_id\\":1488569,\\"answer_id\\":627629,\\"answer_video\\":\\"answer-1567853522_1488569.mp4\\",\\"video_time\\":0,\\"engage_time\\":0,\\"parent_id\\":\\"0\\",\\"is_back\\":0,\\"session_id\\":\\"0\\",\\"tab_id\\":\\"0\\",\\"ip_address\\":0,\\"source\\":\\"android\\",\\"view_from\\":\\"SIMILAR\\",\\"referred_st_id\\":0,\\"view_id\\":110339852},\\"uuid\\":\\"f53cffd4-21be-44a0-bbdd-aa0af936e767\\",\\"timestamp\\":\\"2019-11-21T18:51:19.508Z\\"}",\n  "Timestamp" : "2019-11-21T13:21:19.951Z",\n  "SignatureVersion" : "1",\n  "Signature" : "MnGXdqjAEZPmS1CXXOj4jlA4iALdD4wUXesBKHrMFa4M38Dn7snDG6WEiDFi3tVEelBFpylIkH5Thw47xCocmRICYC+cQR74nElXtxP/FGQiDSJF80/g0TMoEp74xEYrT6AR5QKBIB9OdhkkT2A25VDC6L85+8hU69A2JCHHAj5pjFMKjJxDineZNyz0u57I0gjCQoK+3ByF6Jbt3JmYkwR+2jfSXTr2EbxjJw9oLVR8TCzdHunBPjjhS/Op+VHO3jabdf8DmB3i0jP7z6XHYGsiembJ+Fv4Xlki6sghzBXyaWe+TzfbZgKyQcI4HTQHAwTy1O18OWUNUuFv0w9I9Q==",\n  "SigningCertURL" : "https://sns.ap-south-1.amazonaws.com/SimpleNotificationService-6aad65c2f9911b05cd53efda11f913f9.pem",\n  "UnsubscribeURL" : "https://sns.ap-south-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:ap-south-1:942682721582:video_views:c8c78ae9-fef1-409e-b80c-93c65c683d9c"\n}',
        attributes:
            {
                ApproximateReceiveCount: '1',
                SentTimestamp: '1574342480025',
                SenderId: 'AIDAJKTPXYYAO6CI6DPKS',
                ApproximateFirstReceiveTimestamp: '1574343767897'
            },
        messageAttributes: {},
        md5OfBody: 'c659b7d2bbab936a5a34a21f81adbbc4',
        eventSource: 'aws:sqs',
        eventSourceARN: 'arn:aws:sqs:ap-south-1:942682721582:user-personalisation',
        awsRegion: 'ap-south-1'
    },
    {
        messageId: '132906ef-78cb-4544-b029-dc6924faac40',
        receiptHandle:
            'AQEBRtbENya43AfMb4jDR1HyVqbq3xBg1ijvbtlVvxCkvURaf2uDZiCl/uIcdyFV2XhHNe6zxa/n6TsK9KjNG5tx5BvzaqLztmhaYtyme+a755z2/YLlvwvD1oGxQFWqjx807zzrGC1MHvEZPzFg0BwKGTfpDunh/cki+G5yLE+RvBNP7ctJ+pf88er2aqZ0uKkub8AvQQ3n+vGMvnTsyd9KJi1JUUet6CZe5vVrE/RHYgNKshAhj2dkzR76nB4rKbceaKChx0/VNTK6vmX0BEExFiAjrXRBpCNbh66oqE12VyI/Lx7Gjl/VV07nAA2iqNyI++imH1jdHrdH45vjKpgwOT0UjrDmd6avpZVYGZjibC1rMGolYh+EfNDDL71GiMUz5LiU91LCRrf3tdmSUbnSPQ==',
        body:
            '{\n  "Type" : "Notification",\n  "MessageId" : "22844938-40c9-5f98-a8eb-1f68d1590eb6",\n  "TopicArn" : "arn:aws:sns:ap-south-1:942682721582:video_views",\n  "Message" : "{\\"action\\":\\"VIDEO_VIEW_FROM_APP\\",\\"data\\":{\\"student_id\\":6730970,\\"question_id\\":26770294,\\"answer_id\\":590121,\\"answer_video\\":\\"answer-1566840676_26770294.mp4\\",\\"video_time\\":0,\\"engage_time\\":0,\\"parent_id\\":\\"59609430\\",\\"is_back\\":0,\\"session_id\\":\\"0\\",\\"tab_id\\":\\"0\\",\\"ip_address\\":0,\\"source\\":\\"android\\",\\"view_from\\":\\"SRP\\",\\"referred_st_id\\":0,\\"view_id\\":110339877},\\"uuid\\":\\"8beeff82-9cb0-4fe5-842a-da54f2c12278\\",\\"timestamp\\":\\"2019-11-21T18:51:08.312Z\\"}",\n  "Timestamp" : "2019-11-21T13:21:20.966Z",\n  "SignatureVersion" : "1",\n  "Signature" : "JSv7F7D16Icjehu8KUBRCCFn7Zojy9bgZhFrFzxjEoaJxg4cFivKqPZgiSa+QED8lrNznQYA037sb/0VjUyX3DT14dRCsB5eAuv+hDmGXi68E2E4rwrOsgOZ1aVfyMwBtYswTr+Qz58tSKZ/Ux8B+jrfW7FJphYh2U9q3qNLgnBHhIMgAbRpkOBSxbHV8zYQ+Q4jXJxYxAMYI/YMgSHXrJhMEm61ZDTumoFfyA9xYgsM/FFzgij0KT5kv7oJSEexHNBpsucurvdaT8wvjmtTf+ih6stTmMUf4yVBKF60DcINiEpKJQ0lWDb1aPIi5UHojQ02r0dnJOdVl0B/3PoRXQ==",\n  "SigningCertURL" : "https://sns.ap-south-1.amazonaws.com/SimpleNotificationService-6aad65c2f9911b05cd53efda11f913f9.pem",\n  "UnsubscribeURL" : "https://sns.ap-south-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:ap-south-1:942682721582:video_views:c8c78ae9-fef1-409e-b80c-93c65c683d9c"\n}',
        attributes:
            {
                ApproximateReceiveCount: '1',
                SentTimestamp: '1574342480994',
                SenderId: 'AIDAJKTPXYYAO6CI6DPKS',
                ApproximateFirstReceiveTimestamp: '1574343767897'
            },
        messageAttributes: {},
        md5OfBody: '81e31d6c52021b2d82f3103815d75326',
        eventSource: 'aws:sqs',
        eventSourceARN: 'arn:aws:sqs:ap-south-1:942682721582:user-personalisation',
        awsRegion: 'ap-south-1'
    },
    {
        messageId: 'd7948349-a617-45bb-8e60-de34dd2c56ce',
        receiptHandle:
            'AQEBozSQB9jaJZzt8B5fFaK47X5GGhk2bVx6i8iJx9+j+keasJsFR9EQ9cu0u8c7eABh2YHSM/FVt0QVIix8PjD/8ITSyLfLLOU81CoqJrN21+dkhsTtgqM1PafGxl66Wvz6xTzB98jwrRjQ3DdGEwTGzKyZotWR9G5NAZWehFqF6RYDKFvjfPIXI+JogJCIHA194hqK4XcerK+XWPocXaTShh3WZHqUmoa3V+0UWxS6OHM3Qd+cae+AGKmk2v6YH0Y3UkvDs6x+VMka9LnbWrl7zARGCF6wxPde2HQBM8/QyqVf4Cf/u6Ic1y4XU7DRg5oSTULA3XIGbOM7w0zKX7k1kQCJQxU+2Y673EIIfWAVYpX0Du1KItCcIu0szWRR1lW4ZV3OThn2d4Z4FfY2C9RAqw==',
        body:
            '{\n  "Type" : "Notification",\n  "MessageId" : "97e20696-6ba5-5313-8b8f-50c6fa300ce2",\n  "TopicArn" : "arn:aws:sns:ap-south-1:942682721582:video_views",\n  "Message" : "{\\"action\\":\\"VIDEO_VIEW_FROM_APP\\",\\"data\\":{\\"student_id\\":4544375,\\"question_id\\":3531,\\"answer_id\\":116295,\\"answer_video\\":\\"answer-1530764835.mp4\\",\\"video_time\\":0,\\"engage_time\\":0,\\"parent_id\\":\\"0\\",\\"is_back\\":0,\\"session_id\\":\\"0\\",\\"tab_id\\":\\"0\\",\\"ip_address\\":0,\\"source\\":\\"android\\",\\"view_from\\":\\"NOTIFICATION\\",\\"referred_st_id\\":0,\\"view_id\\":110339996},\\"uuid\\":\\"26823381-bc76-4dda-bf32-9ffb32d1c457\\",\\"timestamp\\":\\"2019-11-21T18:51:12.959Z\\"}",\n  "Timestamp" : "2019-11-21T13:21:25.617Z",\n  "SignatureVersion" : "1",\n  "Signature" : "GKbRTML4Xvikj9EFzX1q7mKMf7tZgsGjWSfAzeJLHnNObVkJaW/gV7T0TfuJFLBsufy/qMAyVf7IcXJayWoT7ly/ebpIKHMzESy3BFLbQY8jEjOipmvNZsN8/mzIbkXSRUmHuZvWkTXsDttWYNJCo5WkCsdd3ngGEd8sP1K2UhjTFF2YiD+sMtmpS5LxSgXK9PbvbX4DvMi0T40kLN2lOKk7GtrLoxnKT6IUi9ix9msId2uGVL3Qh40MQywj5R7gtbHnBor8c8201aRcb2eBsH0XtdX7zFbwpwsqrgzQkQLG8sXQ9V6IUChoUxsRJ0nZZ7ZGdOcSYptqHN9Acy9T1Q==",\n  "SigningCertURL" : "https://sns.ap-south-1.amazonaws.com/SimpleNotificationService-6aad65c2f9911b05cd53efda11f913f9.pem",\n  "UnsubscribeURL" : "https://sns.ap-south-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:ap-south-1:942682721582:video_views:c8c78ae9-fef1-409e-b80c-93c65c683d9c"\n}',
        attributes:
            {
                ApproximateReceiveCount: '1',
                SentTimestamp: '1574342485651',
                SenderId: 'AIDAJKTPXYYAO6CI6DPKS',
                ApproximateFirstReceiveTimestamp: '1574343767897'
            },
        messageAttributes: {},
        md5OfBody: '5d4ca1f54ef4e44a6212eb566f4acf43',
        eventSource: 'aws:sqs',
        eventSourceARN: 'arn:aws:sqs:ap-south-1:942682721582:user-personalisation',
        awsRegion: 'ap-south-1'
    }]
const elasticSearch = require('elasticsearch')


let index_name = 'analytics'
let type_name = 'video_history'
console.log("bye")

const elasticClient = new elasticSearch.Client({
    hosts: ['https://search-test-es-public-f4m2nyzdybfbu7axez7o72q5we.ap-south-1.es.amazonaws.com']
})
async function main() {
    // console.log(event)
    // console.log("hihihihhi")
    // console.log(context)
    // console.log("hihihihhi")
    try {
        let batched_views = records
        // console.log(batched_views)
        if (typeof batched_views !== "undefined" && batched_views.length > 0) {
            await bulkInsertToElastic(batched_views, elasticClient)
        }
        console.log("this is the end")
        return new Promise(function (resolve, reject) {
            resolve("Completed");
        });
    } catch (e) {
        console.log(e)
        return new Promise(function (resolve, reject) {
            reject("Galat Scene")
        })
    }
}
main()

async function bulkInsertToElastic(batched_views,client){
    let data = []
    // console.log(batched_views)
    for (var i in batched_views) {
        let object = JSON.parse(batched_views[i].body)
        object = JSON.parse(object.Message)
        let json = {"view_id":object.data['view_id'], "student_id": object.data["student_id"], "question_id": object.data["question_id"], "answer_id": object.data["answer_id"],"created_at": object.data["created_at"]}
        data.push(json)
    }
    const body = data.flatMap(doc => [{ index: {_index: index_name, _type: type_name, _id:doc['view_id']} }, doc])
    await addIndex(client,body)
}

function addIndex(client, data) {
    return new Promise( ( resolve, reject ) => {
        client.bulk({
            body: data
        }, function (err, resp) {
            console.log("err")
            console.log(err)
            if(err){
                console.log("err")
                console.log(err)
                return reject(err)
            }
            console.log("resp")
            console.log(resp)
            return resolve(resp)
        });
    } );
}
